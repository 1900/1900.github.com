
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Clojure 读写文件</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="/favicon.ico">

    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css?v=c50500171f">

    <link rel="canonical" href="http:///clojure-file-reader-writer/">
    <meta name="referrer" content="origin">
    
    <meta property="og:site_name" content="C'est la vie">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Clojure 读写文件">
    <meta property="og:description" content='Clojure读取文件 简单读文件(slurp)   Clojure IO标准库 使用java io   写文件 简单写文件(split)   Clojure IO 写文件   Clojure读取文件   Clojure读取文件 简单读文件(slurp) 最简单的读取文件可以采用slurp,主要作用是读取文件并以字符串的形式返回文件内容，因为其将文件直接存入内存，此方法适用于小文件的读取。    (slurp "test.file") 在repl里面可以直接打印出字符串内容。 Clojure IO标准库 Clojure中的文件io包装在标准库clojure.java.io包中，我们用reader进行文件读取。 (ns reader.read-file   (:require [clojure.java.io :as io]...'>
    <meta property="og:url" content="http:///clojure-file-reader-writer/">
    <meta property="article:published_time" content="2016-01-29T08:16:31.568Z">
    <meta property="article:modified_time" content="2016-01-29T08:47:33.011Z">
    <meta property="article:tag" content="Clojure">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Clojure 读写文件">
    <meta name="twitter:description" content='Clojure读取文件 简单读文件(slurp)   Clojure IO标准库 使用java io   写文件 简单写文件(split)   Clojure IO 写文件   Clojure读取文件   Clojure读取文件 简单读文件(slurp) 最简单的读取文件可以采用slurp,主要作用是读取文件并以字符串的形式返回文件内容，因为其将文件直接存入内存，此方法适用于小文件的读取。    (slurp "test.file") 在repl里面可以直接打印出字符串内容。 Clojure IO标准库 Clojure中的文件io包装在标准库clojure.java.io包中，我们用reader进行文件读取。 (ns reader.read-file   (:require [clojure.java.io :as io]...'>
    <meta name="twitter:url" content="http:///clojure-file-reader-writer/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "C'est la vie",
    "author": {
        "@type": "Person",
        "name": "Grizzly",
        "url": "http:///author/grizzly",
        "sameAs": null,
        "description": "Never say never!"
    },
    "headline": "Clojure 读写文件",
    "url": "http:///clojure-file-reader-writer/",
    "datePublished": "2016-01-29T08:16:31.568Z",
    "dateModified": "2016-01-29T08:47:33.011Z",
    "keywords": "Clojure",
    "description": "Clojure读取文件 简单读文件(slurp)   Clojure IO标准库 使用java io   写文件 简单写文件(split)   Clojure IO 写文件   Clojure读取文件   Clojure读取文件 简单读文件(slurp) 最简单的读取文件可以采用slurp,主要作用是读取文件并以字符串的形式返回文件内容，因为其将文件直接存入内存，此方法适用于小文件的读取。    (slurp &quot;test.file&quot;) 在repl里面可以直接打印出字符串内容。 Clojure IO标准库 Clojure中的文件io包装在标准库clojure.java.io包中，我们用reader进行文件读取。 (ns reader.read-file   (:require [clojure.java.io :as io]..."
}
    </script>

    <meta name="generator" content="Ghost 0.7">
    <link rel="alternate" type="application/rss+xml" title="C'est la vie" href="http:///rss/index.rss">
</head>
<body class="post-template tag-clojure nav-closed">

    <div class="nav">
    <h3 class="nav-title">菜单</h3>
    <a href="#" class="nav-close">
        <span class="hidden">关闭</span>
    </a>
    <ul>
            <li class="nav-home" role="presentation"><a href="http://1900.github.io/">Home</a></li>
            <li class="nav-java" role="presentation"><a href="http://1900.github.io/tag/java/">Java</a></li>
            <li class="nav-clojure" role="presentation"><a href="http://1900.github.io/tag/clojure/">Clojure</a></li>
            <li class="nav-python" role="presentation"><a href="http://1900.github.io/tag/python/">Python</a></li>
            <li class="nav-linux" role="presentation"><a href="http://1900.github.io/tag/linux/">Linux</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="http:///rss/index.rss">订阅</a>
</div>
<span class="nav-cover"></span>

    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
            <a class="menu-button icon-menu" href="#"><span class="word">菜单</span></a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post tag-clojure">

        <header class="post-header">
            <h1 class="post-title">Clojure 读写文件</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2016-01-29">2016年01月29日</time>  标签：<a href="/tag/clojure/">Clojure</a>
            </section>
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 1900.github.io 468*60 -->
<ins class="adsbygoogle" style="display:inline-block;width:468px;height:60px" data-ad-client="ca-pub-5302593884439812" data-ad-slot="8642310708"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
        </header>

        <section class="post-content">
            <h6 id="clojure">Clojure读取文件</h6>

<ul>
<li><a href="#%E7%AE%80%E5%8D%95%E8%AF%BB%E6%96%87%E4%BB%B6">简单读文件(slurp)</a>  </li>
<li><a href="#Clojure%20IO%E6%A0%87%E5%87%86%E5%BA%93">Clojure IO标准库</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8java%20io">使用java io</a>  </li>
</ul>

<h6 id="">写文件</h6>

<ul>
<li><a href="#%E7%AE%80%E5%8D%95%E5%86%99%E6%96%87%E4%BB%B6">简单写文件(split)</a>  </li>
<li><a href="#Clojure%20IO%20%E5%86%99%E6%96%87%E4%BB%B6">Clojure IO 写文件</a>  </li>
<li><a href="#Clojure%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">Clojure读取文件</a>  </li>
</ul>

<h5 id="clojure">Clojure读取文件</h5>

<p><span id="简单读文件">简单读文件(slurp)</span></p>

<p>最简单的读取文件可以采用slurp,主要作用是读取文件并以字符串的形式返回文件内容，因为其将文件直接存入内存，此方法适用于小文件的读取。</p>

<pre><code>   (slurp "test.file")
</code></pre>

<p>在repl里面可以直接打印出字符串内容。</p>

<p><span id="Clojure IO标准库">Clojure IO标准库</span></p>

<p>Clojure中的文件io包装在标准库clojure.java.io包中，我们用reader进行文件读取。</p>

<pre><code>(ns reader.read-file
  (:require [clojure.java.io :as io]))

(def testfile (io/file "E:/hack/clojure-cook/src/reader/snake.clj"))
(with-open [rdr (io/input-stream testfile)]
  (loop  [c (.read rdr)]
    (if (not= c -1)
      (do 
        (+ x c)
        (recur (.read rdr))))))
</code></pre>

<p>这段代码里用到了两个重要的函数，file和reader。file函数主要获取java.io.File对象。可以使用以下方法来获取file对象。</p>

<pre><code>(ns reader.file-demo
  (:require [clojure.java.io :as io]))

(def f (io/file "E:/hack/clojure-cook/src/reader/snake.clj"))

(def data-f 
  (io/file 
   (io/resource "snake.clj)))
</code></pre>

<p>其中resource是从项目读取资源，需要在project.clj中配置资源的文件夹：</p>

<p>:resource-paths ["E:/hack/clojure-cook/src/reader"]
使用java io</p>

<p>除了读取本地文件，也可以读取网络信息，比如：</p>

<pre><code>(ns reader.file-demo
  (:require [clojure.java.io :as io])
  (:import (java.net URL)
           (java.io InputStreamReader BufferedReader)))


(defn fetch-url[address]
  (with-open [stream (.openStream (URL. address))]
    (let [buf (BufferedReader.
               (InputStreamReader. stream))]
      (apply str (line-seq buf)))))

(fetch-url "http://www.baidu.com")
</code></pre>

<h5 id="">写文件</h5>

<p><span id="简单写文件">简单写文件(split)</span></p>

<pre><code>(ns reader.file-demo
  (:require [clojure.java.io :as io]))
(def out (io/file "demo.file"))
(spit out "test file")
</code></pre>

<p>spit是和slurp相对应的函数，只能进行极小且简单的文件处理，如果进行复杂的文件处理还需要使用Clojure IO库，或者java IO库。</p>

<p><span id="Clojure IO 写文件">Clojure IO 写文件(split)</span>   </p>

<pre><code>(ns reader.file-demo
  (:require [clojure.java.io :as io]))

(def out (io/file "demo.file"))

(defn write-file [content]
  (with-open [w (io/writer out)]
    (.write w content)))

(write-file "test file second")
</code></pre>

<p>来源: <a href="http://blog.brucefeng.info/post/clojure-readwrite-file#toc_5">http://blog.brucefeng.info/post/clojure-readwrite-file#toc_5</a></p>

<h6 id="">补充</h6>

<p>使用slurp抓取网页内容及制定编码  </p>

<pre><code> (slurp "http://163.com" :encoding  "gb2312")
</code></pre>

<p>使用reader提高读取效率</p>

<pre><code class="language-clojure">(require '[clojure.java.io :as io])
(with-open [r (io/reader "file.txt")]
  (doseq [liene (line-seq r)]
    (println line)))  
</code></pre>

<p>使用with-open对多文件操作</p>

<pre><code class="language-clojure">(with-open [r (io/reader "file.txt")
            w (io/writer "file1.txt")]
  (doseq [line (line-seq r)]
    (.write w (str line "\n"))))
</code></pre>

<p>二进制读取</p>

<pre><code class="language-clojure">(with-open [input (new java.io.FileInputStream "image.png")
            output (new java.io.ByteArrayOutputStream)]
    (io/copy input output)
    (.toByteArray output))
</code></pre>

<p>二进制写入</p>

<pre><code class="language-clojure">(with-open [output (new java.io.FileOutputStream "file.bin")]
   (.write output (.getBytes "abcdefg")))
</code></pre>
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 1900.github.io 468 text only -->
<ins class="adsbygoogle" style="display:inline-block;width:468px;height:60px" data-ad-client="ca-pub-5302593884439812" data-ad-slot="1119043901"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
        </section>

        <footer class="post-footer">



            <section class="author">
                <h4><a href="/author/grizzly/">Grizzly</a></h4>

                    <p>Never say never!</p>
                <div class="author-meta">
                    
                    
                </div>
            </section>

			<section class="ads">
		<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 1900.github.io 728 -->
<ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-5302593884439812" data-ad-slot="4072510300"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
<br>
</section>

            <section class="share">
                <h4>Share this post</h4>
                <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
            </section>
		<section class="post-comments">
        <div class="ds-thread" data-thread-key="clojure-file-reader-writer" data-title="Clojure 读写文件" data-url="http:///clojure-file-reader-writer/"></div>
		<script type="text/javascript">
var duoshuoQuery = {short_name:"1900"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
    </section>

        </footer>

    </article>
</main>

<aside class="read-next">
    <a class="read-next-story no-cover" href="/use-clj-time/">
        <section class="post">
            <h2>clj-time 简单使用</h2>
            <p>clj-time 是一个Clojure语言的日期和时间处理库，封装自 Joda Time 库。 (ns test.test-clj   (:use [clj-time.format])   (:require [clj-time.local :as loc]             [clj-time.format…</p>
        </section>
    </a>
    <a class="read-next-story prev no-cover" href="/byte-collection-to-string-on-clojure/">
        <section class="post">
            <h2>How to convert byte to string and  convert string to byte on Clojure</h2>
            <p>Byte,String 在clojure中互转： (ns test   (:require [clojure.string]             [clojure.stacktrace]             [clojure.tools.logging :as log]             )) (defn- string-to-bytes [s] (.getBytes…</p>
        </section>
    </a>
</aside>



        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://">C'est la vie</a> © 2016</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a> &amp; <a href="http://www.ghostchina.com">GhostChina</a></section>
        </footer>

    </div>

    

    <script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <script src="//cdn.bootcss.com/fitvids/1.1.0/jquery.fitvids.min.js"></script>
    <script src="/assets/js/index.js?v=c50500171f"></script>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?f55c526b561f3da50f420ad2a26d946a";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>
